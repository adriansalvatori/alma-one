const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export function moduleData(){return{props:{display:String,name:String,block:Object},data:function(){return{frame:!1,loading:!0,fullScreen:!1,breadCrumbs:[],startPage:this.returnAdminPage(),cornertickle:!1,currentURL:!1}},inject:["uipData","uipress","uiTemplate","router"],watch:{"uipData.themeStyles":{handler(e,t){this.injectStyles()},deep:!0},"uiTemplate.globalSettings.options.advanced.css":{handler(e,t){this.injectStyles()},deep:!0}},mounted:function(){let e=this;const t=document.getElementById(e.block.uid);if("prod"==e.uiTemplate.display&&window.addEventListener("message",function(i){i.data&&"uip_request_fullscreen"===i.data.eventName&&(e.isFullScreen()||(t.classList.add("uip-fullscreen-mode"),t.classList.add("uip-scale-in-bottom-right"))),i.data&&"uip_exit_fullscreen"===i.data.eventName&&e.isFullScreen()&&(t.classList.remove("uip-fullscreen-mode"),t.classList.remove("uip-scale-in-bottom-right"))},!1),this.frame=this.$refs.contentframe,"prod"==e.uiTemplate.display){if(e.startPage=window.location.href,e.returnHomePage){let t=this.uipData.dynamicOptions.viewadmin.value;if(e.startPage==t||e.startPage==t+"#/"){new RegExp("^(?:[a-z+]+:)?//","i").test(e.returnHomePage)?e.startPage=e.returnHomePage:e.startPage=t+e.returnHomePage}}let t=new URL(e.startPage);t=e.formatUserUrlOptions(t),e.frame.contentWindow.location.replace(t),e.uipress.updateActiveLink(e.startPage.replace("#/","")),window.onpopstate=function(){window.location.href!=e.startPage&&(e.startPage=window.location.href)},window.onhashchange=function(){window.location.href!=e.startPage&&(e.startPage=window.location.href)}}document.addEventListener("uip_breadcrumbs_change",t=>{e.breadCrumbs=t.detail.crumbs},{once:!1}),document.addEventListener("uip_update_frame_url",t=>{let i=t.detail.url;e.loading=!0,setTimeout(function(){e.loading=!1},2e3),i=e.formatUserUrlOptions(i),e.frame.contentWindow&&e.frame.contentWindow.location.replace(i)},{once:!1}),this.frame.onload=function(){e.frame.contentDocument.body.classList.contains("is-fullscreen-mode")?e.setFullScreen():e.removeFullScreen(),e.frame.contentDocument.addEventListener("locationchange",function(){console.log("location changed!")});try{e.frame.contentWindow.title}catch(t){return void(e.currentURL&&window.location.assign(e.currentURL))}e.frame.contentWindow,e.loading=!1,e.injectStyles();let t=e.frame.contentDocument.title;t&&""!=t&&(document.title=t),"prod"!=e.uiTemplate.display&&(e.frame.contentDocument.body.addEventListener("click",function(){e.$refs.frameContainer.click()}),e.frame.contentDocument.body.addEventListener("contextmenu",function(t){t.preventDefault();let i={x:t.pageX,y:t.pageY},n=new CustomEvent("right_click_frame",{detail:{pos:i,uid:e.block.uid}});document.dispatchEvent(n)})),this.uipPageChangeLoaded=new CustomEvent("uip_page_change_loaded"),document.dispatchEvent(this.uipPageChangeLoaded),e.updatePageUrls()},this.iframeURLChange(e.frame,function(t){e.uipPageChangeStarted=new CustomEvent("uip_page_change_started"),document.dispatchEvent(e.uipPageChangeStarted),e.loading=!0,e.currentURL=t,setTimeout(function(){e.loading=!1},2e3);let i=new URL(t);e.uipress.forceReload(i);let n=!1;if(e.frame.contentWindow.document.documentElement&&(n=e.frame.contentWindow.document.documentElement.getAttribute("uip-framed-page")),"undefined"==typeof UIPfrontEndReload||!UIPfrontEndReload||"builder"==e.uiTemplate.display||i.href.includes(e.returnAdminPage())){if(i.searchParams.get("uip-framed-page")||n){let i=e.frame.contentWindow.document.querySelectorAll("#adminmenu a[aria-current='page']"),n=t;return i[0]&&(n=i[0].getAttribute("href")),n.includes("about:blank")?(e.injectStyles(),void(e.loading=!1)):(e.uipress.updateActiveLink(n),e.injectStyles(),void(e.loading=!1))}i=e.formatUserUrlOptions(i),e.frame.contentWindow.location.replace(i)}else window.location.assign(i)})},computed:{returnHomePage(){let e=this.uipress.get_block_option(this.block,"block","loginRedirect",!0);return this.uipress.isObject(e)?"value"in e&&e.value:e},returnTheme(){let e=this.uipress.get_block_option(this.block,"block","disableTheme");return this.uipress.isObject(e)?!("value"in e)||e.value:e},returnNotices(){let e=!1,t=this.uipress.get_block_option(this.block,"block","hidePluginNotices");return this.uipress.isObject(t)&&("value"in t&&(e=t.value),e=!1),JSON.stringify(this.uiTemplate.content).includes("site-notifications")&&(e=!0),e},hideLoader(){let e=this.uipress.get_block_option(this.block,"block","hideLoader");return this.uipress.isObject(e)?!("value"in e)||e.value:e},returnScreen(){let e=this.uipress.get_block_option(this.block,"block","hideScreenOptions");return this.uipress.isObject(e)?!("value"in e)||e.value:e},returnHelp(){let e=this.uipress.get_block_option(this.block,"block","hideHelpTab");return this.uipress.isObject(e)?!("value"in e)||e.value:e},disableFullScreen(){let e=this.uipress.get_block_option(this.block,"block","disableFullScreen");return this.uipress.isObject(e)?!("value"in e)||e.value:e},returnClasses(){let e="";return this.fullScreen&&(e+="uip-fullscreen-mode uip-scale-in-bottom-right uip-z-index-9"),e},returnTemplateCSS(){if(void 0!==this.uiTemplate.globalSettings.options)return"advanced"in this.uiTemplate.globalSettings.options&&"css"in this.uiTemplate.globalSettings.options.advanced?this.uiTemplate.globalSettings.options.advanced.css:void 0}},methods:{returnAdminPage(){return this.uipress.checkNestedValue(this.uipData,["dynamicOptions","viewadmin","value"])},updatePageUrls(){let e=this,t=[],i=this.uipData.options.adminURL;t=e.frame.contentWindow.document.querySelectorAll("form");for(let n of t){let t=n.action;void 0!==t&&""!=t&&"string"==typeof t&&(t.includes(i)&&(n.action=e.formatRequiredParams(t)))}let n=e.frame.contentWindow.document.querySelectorAll("body.update-php a");for(let t of n){let n=t.href;if(void 0!==n&&""!=n&&"string"==typeof n)if(n.includes(i))t.href=e.formatRequiredParams(n);else{let a=i+n,r=e.formatRequiredParams(a);r=r.replace(i,""),t.href=r}}},formatUserUrlOptions(e){return e.searchParams.set("uip-framed-page",1),this.returnScreen&&e.searchParams.set("uip-hide-screen-options",1),this.returnHelp&&e.searchParams.set("uip-hide-help-tab",1),this.returnTheme&&e.searchParams.set("uip-default-theme",1),this.returnNotices&&e.searchParams.set("uip-hide-notices",1),e.searchParams.set("uipid",this.uiTemplate.id),e},formatRequiredParams(e){let t=new URL(e);return t.searchParams.set("uip-framed-page",1),this.returnScreen&&t.searchParams.set("uip-hide-screen-options",1),this.returnHelp&&t.searchParams.set("uip-hide-help-tab",1),this.returnTheme&&t.searchParams.set("uip-default-theme",1),this.returnNotices&&t.searchParams.set("uip-hide-notices",1),t.searchParams.set("uipid",this.uiTemplate.id),t.href},isFullScreen(){let e=document.getElementById(this.block.uid);if(e)return!!e.classList.contains("uip-fullscreen-mode")},toggleFullScreen(){document.getElementById(this.block.uid);this.isFullScreen()?this.removeFullScreen():this.setFullScreen()},setFullScreen(){let e=document.getElementById(this.block.uid);e.classList.add("uip-fullscreen-mode"),e.classList.add("uip-scale-in-bottom-right")},removeFullScreen(){let e=document.getElementById(this.block.uid);e.classList.remove("uip-fullscreen-mode"),e.classList.remove("uip-scale-in-bottom-right")},injectStyles(){if("prod"==this.uiTemplate.display)return;let e=this.uipData.themeStyles;this.frame=this.$refs.contentframe;let t=this.frame.contentWindow.document.getElementById("uip-theme-styles");if(!t)return;let i='html[data-theme="light"]{';for(let t in e){let n=e[t];n.value&&(i+=n.name+":"+n.value+";")}i+="}";let n='html[data-theme="dark"]{';for(let t in e){let i=e[t];i.darkValue&&(n+=i.name+":"+i.darkValue+";")}n+="}";let a=this.returnTemplateCSS;t.innerHTML=i+n+a},injectCSS(){this.frame=this.$refs.contentframe;let e=this.frame.contentWindow.document.getElementById("uip-theme-styles");if(!e)return;let t=this.returnTemplateCSS;e.innerText=t},iframeURLChange(e,t){let i=null,n=function(){if(e.contentWindow){var n=e.contentWindow.location.href;n!==i&&(t(n),i=n)}},a=function(){setTimeout(n,0)};function r(){e.contentWindow.removeEventListener("unload",a),e.contentWindow.addEventListener("unload",a)}e.addEventListener("load",function(){r(),n()}),r()}},template:'\n    <div ref="frameContainer" class="uip-flex uip-flex-column uip-overflow-hidden uip-content-frame uip-overflow-hidden uip-position-relative" :class="returnClasses">\n      <div class="uip-position-relative" v-if="!hideLoader">\n        <div ref="loader" :class="block.uid" class="uip-ajax-loader" v-if="loading">\n        <div :class="block.uid" class="uip-loader-bar"></div>\n        </div>\n      </div>\n      \n      <iframe v-if="uiTemplate.display == \'prod\'" ref="contentframe" \n      class="uip-page-content-frame uip-background-default uip-scrollbar uip-w-100p uip-flex-grow"></iframe>\n      \n      <iframe v-else :src="startPage" ref="contentframe" \n      class="uip-page-content-frame uip-background-default uip-scrollbar uip-w-100p uip-flex-grow"></iframe>\n       \n      <div @mouseover="cornertickle = true" @mouseleave="cornertickle = false" class="uip-position-absolute uip-text-muted uip-top-0 uip-right-0 uip-cursor-pointer uip-flex uip-flex-column uip-flex-middle uip-padding-xs" v-if="!disableFullScreen">\n      \n        <div @click="toggleFullScreen()" v-if="cornertickle" class="uip-border-box uip-background-muted uip-text-muted uip-padding-xxxs uip-link-muted hover:uip-background-grey uip-flex uip-flex-column uip-flex-middle uip-fade-in uip-shadow-small uip-border-round" style="pointer-events: all">\n        <span v-if="isFullScreen()" class="uip-icon uip-text-l uip-slide-in-right uip-line-height-1">fullscreen_exit</span>\n        <span v-if="!isFullScreen()" class="uip-icon uip-text-l uip-line-height-1">fullscreen</span>\n        </div>\n        \n      </div>\n      \n      <template v-else>\n        \n        <component v-if="disableFullScreen" is="style">\n        .uip-fullscreen-toggle {\n         display:none; \n        }\n        .uip-fullscreen-mode .uip-fullscreen-toggle {\n         display:block; \n        }\n        </component>\n        \n        <div @mouseover="cornertickle = true" @mouseleave="cornertickle = false" class="uip-position-absolute uip-text-muted uip-top-0 uip-right-0 uip-cursor-pointer uip-flex uip-flex-column uip-flex-middle uip-padding-xs" v-if="!disableFullScreen">\n        \n        <div @click="toggleFullScreen()" v-if="cornertickle" class="uip-border-box uip-background-muted uip-text-muted uip-padding-xxxs uip-link-muted hover:uip-background-grey uip-flex uip-flex-column uip-flex-middle uip-fade-in uip-shadow-small uip-border-round" style="pointer-events: all">\n          <span v-if="isFullScreen()" class="uip-icon uip-text-l uip-slide-in-right uip-line-height-1">fullscreen_exit</span>\n          <span v-if="!isFullScreen()" class="uip-icon uip-text-l uip-line-height-1">fullscreen</span>\n        </div>\n        \n        </div>\n      \n      </template>\n    </div>\n    '}};